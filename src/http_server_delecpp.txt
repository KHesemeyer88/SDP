#include "http_server.h"
#include "webpage.h"
#include "rtos_tasks.h"
#include "logging.h"
#include "websocket_handler.h"
#include "gnss.h"

// HTTP server instance on port 80
AsyncWebServer server(80);

// Initialize HTTP server with all route handlers
void initHttpServer() {
    
    // Root route - serves the main webpage
    server.on("/", HTTP_GET, [](AsyncWebServerRequest *request) {
        request->send(200, "text/html", webPage);
    });

    server.begin();
}

// HTTP server task function
void HttpServerTask(void *pvParameters) {
    // Initialize task
    //LOG_DEBUG("HTTP task start");
    
    // Initialize server routes and start the server
    initHttpServer();
     for (;;) {        
        // Task heartbeat
        vTaskDelay(pdMS_TO_TICKS(1000));
    }
}